<!DOCTYPE html>
<html>

<head>
	<title>MQTT Client</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>
	<script src="js/util.js" type="text/javascript"></script>
	<script type="text/javascript">
		const connection = connectionInfo(location);
		console.log(connection);
		const client = new Paho.MQTT.Client(connection.host, connection.port, connection.clientID);
		client.onConnectionLost = onConnectionLost;
		client.onMessageArrived = onMessageArrived;
		client.connect({ onSuccess: onConnect });
		console.log("Connecting to:" + connection.host);

		function onConnect() {
			// Once a connection has been made, make a subscription and send a message.
			console.log("Connected");
			client.subscribe(connection.topic);
			const payload = {roomId: 1, sensorType: 'knob', measurement: 555};
			var message = new Paho.MQTT.Message(JSON.stringify(payload));
			message.destinationName = connection.topic;
			client.send(message);
		}

		function onConnectionLost(responseObject) {
			if (responseObject.errorCode !== 0)
				console.log("Connexion lost:" + responseObject.errorMessage);
		}

		function onMessageArrived(message) {
			console.log("Message arrived:" + message.payloadString);
			//client.disconnect();
		}

	</script>
</head>

<body>
	<div>Ouvrez la consolex</div>
</body>

</html>